{
    "$id": "https://mxlims.org/schemas/messages/ShipmentMessage.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "description": "Message containing a shipment of either frozen crystals or crystallization plates",
    "title": "ShipmentMessage",
    "type": "object",
    "allOf": [
        {
            "$ref": "../messages/BaseMessageData.json"
        }
    ],
    "properties": {
        "Shipment": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/Shipment"
                }
            ],
            "maxProperties": 1,
            "additionalProperties": {
                "required": [
                    "labContactOutbound",
                    "labContactReturn"
                ]
            }
        },
        "Plate": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/Plate"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef",
                    "barcode",
                    "plateType"
                ]
            }
        },
        "PlateWell": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/PlateWell"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef"
                ]
            }
        },
        "WellDrop": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/WellDrop"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef"
                ]
            }
        },
        "DropRegion": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/DropRegion"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef"
                ]
            }
        },
        "Dewar": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/Dewar"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef"
                ]
            }
        },
        "Puck": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/Puck"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef"
                ]
            }
        },
        "MultiPin": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/MultiPin"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef"
                ]
            }
        },
        "Pin": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/Pin"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef"
                ]
            }
        },
        "PinPosition": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/PinPosition"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef",
                    "sampleRef"
                ]
            }
        },
        "MacromoleculeSample": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/MacromoleculeSample"
                }
            ],
            "additionalProperties": {
                "required": [
                    "name",
                    "parentSampleRef"
                ],
                "properties": {
                    "macromolecule": {
                        "required": [
                            "acronym"
                        ]
                    }
                }
            }
        },
        "Macromolecule": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/Macromolecule"
                }
            ],
            "additionalProperties": {
                "required": [
                    "acronym"
                ]
            }
        },
        "Crystal": {
            "allOf": [
                {
                    "$ref": "../messages/MxlimsMessageStrict.json#/properties/Crystal"
                }
            ],
            "additionalProperties": {
                "required": [
                    "containerRef",
                    "sampleRef",
                    "name"
                ]
            }
        }
    },
    "required": [
        "Shipment",
        "MacromoleculeSample",
        "Macromolecule"
    ],
    "oneOf": [
        {
            "$comment": "This is a frozen-crystal shipment of dewars, pucks and traditional one-position loops. PinPositions are not allowed, and Pins must have a sampleRef",
            "title": "PinShipment",
            "required": [
                "Dewar",
                "Puck",
                "Pin"
            ],
            "properties": {
                "MultiPin": false,
                "PinPosition": false,
                "Plate": false,
                "PlateWell": false,
                "WellDrop": false,
                "DropRegion": false,
                "Pin": {
                    "additionalProperties": {
                        "required": [
                            "sampleRef"
                        ]
                    }
                }
            }
        },
        {
            "$comment": "This is a frozen-crystal shipment of dewars, pucks and multi-position pins. Single-position actual pins must be declared as MultiPins with one pin position, and PinPositions are required",
            "title": "MultiPinShipment",
            "required": [
                "Dewar",
                "Puck",
                "MultiPin",
                "PinPosition"
            ],
            "properties": {
                "Pin": false,
                "Plate": false,
                "PlateWell": false,
                "WellDrop": false,
                "DropRegion": false
            }
        },
        {
            "$comment": "This is a shipment of plates",
            "title": "PlateShipment",
            "required": [
                "Plate",
                "PlateWell",
                "WellDrop",
                "DropRegion",
                "Crystal"
            ],
            "properties": {
                "Dewar": false,
                "Puck": false,
                "Pin": false,
                "MultiPin": false,
                "PinPosition": false
            }
        }
    ],
    "unevaluatedProperties": false
}
